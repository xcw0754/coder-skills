# volatile关键字

### Q：volatile关键字的作用是什么？
> A：有时我们会使用编译器优化选项，让编译器去优化我们的代码，但是机器毕竟是机器，它没有考虑多线程情况。如果程序需要从内存中取值，而此时恰好寄存器中有该值，那么编译器可能会优化成从寄存器中直接取值，那么多线程下就不安全了。举个例子

```
int a = 0;
a = 5 * 2;
int c = a << 1;
```
这里只假设优化了第3行的代码，当a被赋值5 * 2后将a送至磁盘存起来，c此时需要读a的值，而a的值在寄存器中还有备份，那么直接拷过来就不用去内存中读这么麻烦了，所以被编译器优化了。若有其他进程修改了a的值，那么直接从寄存器中烤来的值就过时了。为了避免这样的问题发生，`volatile`是用于修饰变量的，被其修饰的变量每次存取值都会去内存中存取，也不能优化其执行次序，这是编译器做的。

### Q：volatile和const可以同时修饰一个变量吗？
> A：可以的，只是几乎用不上。
> `const`修饰的，表示该变量不能被程序所修改。(只读不可写)
> `volatile`修饰的，表示告诉编译器别优化这个变量相关的代码。同时修饰一个变量是合乎语法的，可编译通过。
> PS：const修饰的变量只是不能被程序所修改，要是外部修改那就不一定了，比如部分机器的中断处理可能会有硬件参与操作，那么硬件不会管你是谁，该改就改，不过这种可能性不大。